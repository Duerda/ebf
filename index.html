<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>EBF - Sistema de Presen√ßa</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
body {
  background: #f2f2f2;
  padding: 20px;
}
.container {
  background: #fff;
  border-radius: 12px;
  padding: 25px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
h1 { text-align: center; margin-bottom: 20px; }
.btn { margin: 5px; }
.presente { background: #4caf50; color: white; }
.falta { background: #f44336; color: white; }
</style>
</head>
<body>
<div class="container">
  <h1>üìñ Controle de Presen√ßa EBF</h1>

  <div class="mb-3">
    <label>Data: <input type="date" id="data" class="form-control"></label>
  </div>

  <div class="mb-3">
    <label>Sala:
      <select id="sala" class="form-select">
        <option value="0-4">0 a 4 anos</option>
        <option value="5-7">5 a 7 anos</option>
        <option value="8-11">8 a 11 anos</option>
        <option value="12-20">12 a 20 anos</option>
        <option value="maes">Sala das M√£es</option>
      </select>
    </label>
  </div>

  <div id="lista" class="mb-3"></div>

  <button class="btn btn-primary" onclick="salvarChamada()">Salvar Chamada</button>
  <button class="btn btn-secondary" onclick="gerarPDFChamada()">üìÑ Salvar Chamada em PDF</button>
  <button class="btn btn-warning" onclick="gerarRelatorio()">üìä Ver Relat√≥rio</button>
  <button class="btn btn-success" onclick="gerarPDFRelatorio()">üìÑ Salvar Relat√≥rio em PDF</button>

  <div id="relatorio" class="mt-4"></div>
</div>

<script>
let alunos = {
  "0-4": ["Ana", "Carlos"],
  "5-7": ["Lucas", "Bruna"],
  "8-11": ["Pedro", "Giovana"],
  "12-20": ["Marcos", "Julia"],
  "maes": ["Patr√≠cia"]
};

let presencas = {};

function carregarChamada() {
  let sala = document.getElementById('sala').value;
  let html = '';
  alunos[sala].forEach(nome => {
    html += `<div class='mb-2'>${nome}
      <button class='btn btn-sm presente' onclick="registrar('${nome}','presente')">‚úÖ</button>
      <button class='btn btn-sm falta' onclick="registrar('${nome}','falta')">‚ùå</button></div>`;
  });
  document.getElementById('lista').innerHTML = html;
}

document.getElementById('sala').addEventListener('change', carregarChamada);

function registrar(nome, status) {
  let data = document.getElementById('data').value;
  let sala = document.getElementById('sala').value;
  if (!data) return alert('Selecione uma data!');
  if (!presencas[data]) presencas[data] = {};
  if (!presencas[data][sala]) presencas[data][sala] = {};
  presencas[data][sala][nome] = status;
}

function salvarChamada() {
  alert('Chamada salva!');
}

function gerarPDFChamada() {
  let element = document.getElementById('lista');
  html2pdf().from(element).save('chamada.pdf');
}

function gerarRelatorio() {
  let data = document.getElementById('data').value;
  if (!data) return alert('Selecione uma data!');
  let html = `<h3>Relat√≥rio - ${data}</h3>`;
  for (let sala in alunos) {
    let total = alunos[sala].length;
    let presentes = 0, faltas = 0;
    if (presencas[data] && presencas[data][sala]) {
      for (let nome in presencas[data][sala]) {
        if (presencas[data][sala][nome] === 'presente') presentes++;
        if (presencas[data][sala][nome] === 'falta') faltas++;
      }
    }
    html += `<div class='border p-2 mb-2'><strong>${sala}</strong><br>
    Alunos: ${total}<br>
    Presentes: ${presentes}<br>
    Faltas: ${faltas}</div>`;
  }
  document.getElementById('relatorio').innerHTML = html;
}

function gerarPDFRelatorio() {
  let element = document.getElementById('relatorio');
  html2pdf().from(element).save('relatorio.pdf');
}
</script>
</body>
</html>
