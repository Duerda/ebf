<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>EBF - Sistema de Controle</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Comic Sans MS', Arial, sans-serif;
    background: linear-gradient(135deg, #74b9ff, #0dbc79, #fdcb6e);
    min-height: 100vh;
    padding: 20px;
  }
  .container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    border-radius: 20px;
    padding: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  }
  h1 {
    text-align: center;
    color: #2d3436;
    margin-bottom: 30px;
    font-size: 2.5em;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
  }
  .nav {
    display: flex;
    gap: 15px;
    margin-bottom: 30px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .btn {
    padding: 15px 25px;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    font-size: 16px;
    font-weight: bold;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
  }
  .btn-primary { background: #74b9ff; color: white; }
  .btn-success { background: #00b894; color: white; }
  .btn-warning { background: #fdcb6e; color: #2d3436; }
  .btn-danger { background: #e17055; color: white; }
  .btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }
  .section { display: none; }
  .section.active { display: block; }
  .form-group { margin-bottom: 20px; }
  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
    color: #2d3436;
  }
  .form-group input, .form-group select {
    width: 100%;
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 10px;
    font-size: 16px;
  }
  .form-group input:focus, .form-group select:focus {
    border-color: #74b9ff;
    outline: none;
  }
  .aluno-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    margin: 10px 0;
    background: #f8f9fa;
    border-radius: 10px;
    border: 2px solid #e9ecef;
  }
  .aluno-nome {
    font-weight: bold;
    color: #2d3436;
  }
  .presenca-btns {
    display: flex;
    gap: 10px;
  }
  .btn-small {
    padding: 8px 15px;
    font-size: 14px;
  }
  .relatorio-card {
    background: #f8f9fa;
    padding: 20px;
    margin: 15px 0;
    border-radius: 15px;
    border: 2px solid #e9ecef;
  }
  .sala-destaque {
    border: 3px solid gold;
    background: linear-gradient(45deg, #fff9c4, #f7e98e);
    position: relative;
  }
  .sala-destaque::before {
    content: "ü•á";
    position: absolute;
    top: -10px;
    right: -10px;
    font-size: 2em;
  }
  .stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin: 20px 0;
  }
  .stat-card {
    background: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    border: 2px solid #e9ecef;
  }
  .stat-number {
    font-size: 2em;
    font-weight: bold;
    color: #74b9ff;
  }
  .stat-label {
    color: #636e72;
    font-size: 14px;
  }
  .loading {
    text-align: center;
    padding: 20px;
    color: #74b9ff;
  }
  .success-msg {
    background: #d4edda;
    color: #155724;
    padding: 15px;
    border-radius: 10px;
    margin: 15px 0;
    text-align: center;
    font-weight: bold;
  }
  @media (max-width: 600px) {
    .container {
      padding: 20px;
      margin: 10px;
    }
    h1 {
      font-size: 2em;
    }
    .nav {
      flex-direction: column;
    }
    .aluno-item {
      flex-direction: column;
      gap: 10px;
      text-align: center;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <h1>üé™ EBF - Escola B√≠blica de F√©rias</h1>

    <div class="nav">
      <button class="btn btn-primary" onclick="showSection('home')">üè† In√≠cio</button>
      <button class="btn btn-success" onclick="showSection('cadastro')">üë∂ Cadastro</button>
      <button class="btn btn-warning" onclick="showSection('chamada')">üìã Chamada</button>
      <button class="btn btn-danger" onclick="showSection('relatorio')">üìä Relat√≥rio</button>
    </div>

    <!-- HOME -->
    <div id="home" class="section active">
      <div style="text-align: center;">
        <h2>üåü Bem-vindo ao Sistema da EBF!</h2>
        <p style="margin: 20px 0; font-size: 18px; color: #636e72;">
          Gerencie cadastros, chamadas e relat√≥rios de forma simples e eficiente.
        </p>
        <div class="stats" id="homeStats">
          <div class="stat-card">
            <div class="stat-number" id="totalAlunos">0</div>
            <div class="stat-label">Total de Alunos</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="presentesHoje">0</div>
            <div class="stat-label">Presentes Hoje</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="faltasHoje">0</div>
            <div class="stat-label">Faltas Hoje</div>
          </div>
        </div>
      </div>
    </div>

    <!-- CADASTRO -->
    <div id="cadastro" class="section">
      <h2>üë∂ Cadastro de Alunos</h2>
      <form id="formCadastro">
        <div class="form-group">
          <label>Nome Completo:</label>
          <input type="text" id="nomeAluno" required />
        </div>
        <div class="form-group">
          <label>Sala:</label>
          <select id="salaAluno" required>
            <option value="">Selecione a sala...</option>
            <option value="0-4">0 a 4 anos</option>
            <option value="5-7">5 a 7 anos</option>
            <option value="8-11">8 a 11 anos</option>
            <option value="12-20">12 a 20 anos</option>
            <option value="maes">Sala das M√£es</option>
          </select>
        </div>
        <button type="submit" class="btn btn-success">‚úÖ Cadastrar Aluno</button>
      </form>
      <div id="msgCadastro"></div>
    </div>

    <!-- CHAMADA -->
    <div id="chamada" class="section">
      <h2>üìã Chamada Di√°ria</h2>
      <div class="form-group">
        <label>Selecione a Data da Chamada:</label>
        <input type="date" id="dataChamada" onchange="carregarChamada()" />
      </div>
      <div class="form-group">
        <label>Selecione a Sala:</label>
        <select id="salaChamada" onchange="carregarChamada()">
          <option value="">Selecione a sala...</option>
          <option value="0-4">0 a 4 anos</option>
          <option value="5-7">5 a 7 anos</option>
          <option value="8-11">8 a 11 anos</option>
          <option value="12-20">12 a 20 anos</option>
          <option value="maes">Sala das M√£es</option>
        </select>
      </div>

      <!-- Cadastro r√°pido durante chamada -->
      <div
        id="cadastroRapido"
        style="display: none; background: #e3f2fd; padding: 15px; border-radius: 10px; margin: 15px 0"
      >
        <h3>‚ûï Cadastro R√°pido</h3>
        <div style="display: flex; gap: 10px; align-items: end">
          <div class="form-group" style="flex: 1; margin: 0">
            <input type="text" id="nomeRapido" placeholder="Nome do aluno..." />
          </div>
          <button class="btn btn-primary btn-small" onclick="cadastroRapido()">
            Adicionar
          </button>
        </div>
      </div>

      <div id="listaChamada"></div>
      <button
        id="btnSalvarChamada"
        class="btn btn-success"
        onclick="salvarChamada()"
        style="display: none"
      >
        üíæ Salvar Chamada
      </button>
      <div id="msgChamada"></div>
    </div>

    <!-- RELAT√ìRIO -->
    <div id="relatorio" class="section">
      <h2>üìä Relat√≥rio Di√°rio</h2>
      <div class="form-group">
        <label>Selecione a Data:</label>
        <input type="date" id="dataRelatorio" onchange="carregarRelatorio()" />
      </div>
      <div id="conteudoRelatorio"></div>
    </div>
  </div>

  <script type="module">
    // Simula√ß√£o do Firebase (em mem√≥ria)
    let dados = {
      alunos: {},
      chamadas: {},
    };

    // Fun√ß√µes do sistema
    window.showSection = function (sectionId) {
      document.querySelectorAll(".section").forEach((s) =>
        s.classList.remove("active")
      );
      document.getElementById(sectionId).classList.add("active");

      if (sectionId === "home") atualizarHome();
      if (sectionId === "relatorio")
        document.getElementById("dataRelatorio").value = new Date()
          .toISOString()
          .split("T")[0];
    };

    window.atualizarHome = function () {
      const total = Object.keys(dados.alunos).length;
      const hoje = new Date().toISOString().split("T")[0];
      const chamadaHoje = dados.chamadas[hoje] || {};

      let presentes = 0,
        faltas = 0;
      Object.values(chamadaHoje).forEach((sala) => {
        Object.values(sala).forEach((status) => {
          if (status === "presente") presentes++;
          else if (status === "falta") faltas++;
        });
      });

      document.getElementById("totalAlunos").textContent = total;
      document.getElementById("presentesHoje").textContent = presentes;
      document.getElementById("faltasHoje").textContent = faltas;
    };

    // Cadastro
    document.getElementById("formCadastro").onsubmit = function (e) {
      e.preventDefault();
      const nome = document.getElementById("nomeAluno").value.trim();
      const sala = document.getElementById("salaAluno").value;

      if (!nome || !sala) return;

      const id = Date.now().toString();
      dados.alunos[id] = { nome, sala, id };

      document.getElementById("msgCadastro").innerHTML =
        '<div class="success-msg">‚úÖ Aluno cadastrado com sucesso!</div>';
      document.getElementById("formCadastro").reset();

      setTimeout(() => (document.getElementById("msgCadastro").innerHTML = ""), 3000);
    };

    // Chamada
    window.carregarChamada = function () {
      const sala = document.getElementById("salaChamada").value;
      const dataSelecionada = document.getElementById("dataChamada").value;

      if (!sala || !dataSelecionada) {
        document.getElementById("listaChamada").innerHTML = "";
        document.getElementById("btnSalvarChamada").style.display = "none";
        document.getElementById("cadastroRapido").style.display = "none";
        return;
      }

      document.getElementById("cadastroRapido").style.display = "block";

      const alunosSala = Object.values(dados.alunos).filter((a) => a.sala === sala);
      const chamadaData = dados.chamadas[dataSelecionada]?.[sala] || {};

      let html = "<h3>üë• Lista de Alunos:</h3>";

      if (alunosSala.length === 0) {
        html +=
          '<p style="text-align: center; color: #636e72; padding: 20px;">Nenhum aluno cadastrado nesta sala.</p>';
      } else {
        alunosSala.forEach((aluno) => {
          const status = chamadaData[aluno.id] || "";
          html += `
            <div class="aluno-item">
              <div class="aluno-nome">${aluno.nome}</div>
              <div class="presenca-btns">
                <button class="btn btn-success btn-small ${
                  status === "presente" ? "active" : ""
                }" onclick="marcarPresenca('${aluno.id}', 'presente')">‚úÖ Presente</button>
                <button class="btn btn-danger btn-small ${
                  status === "falta" ? "active" : ""
                }" onclick="marcarPresenca('${aluno.id}', 'falta')">‚ùå Falta</button>
              </div>
            </div>
          `;
        });
      }

      document.getElementById("listaChamada").innerHTML = html;
      document.getElementById("btnSalvarChamada").style.display = "block";
    };

    window.marcarPresenca = function (alunoId, status) {
      const sala = document.getElementById("salaChamada").value;
      const dataSelecionada = document.getElementById("dataChamada").value;
      if (!dataSelecionada) return;

      if (!dados.chamadas[dataSelecionada]) dados.chamadas[dataSelecionada] = {};
      if (!dados.chamadas[dataSelecionada][sala])
        dados.chamadas[dataSelecionada][sala] = {};

      dados.chamadas[dataSelecionada][sala][alunoId] = status;
      carregarChamada(); // Atualiza lista
    };

    window.cadastroRapido = function () {
      const nome = document.getElementById("nomeRapido").value.trim();
      const sala = document.getElementById("salaChamada").value;
      const dataSelecionada = document.getElementById("dataChamada").value;

      if (!nome || !sala || !dataSelecionada) return;

      const id = Date.now().toString();
      dados.alunos[id] = { nome, sala, id };

      document.getElementById("nomeRapido").value = "";
      carregarChamada();
    };

    window.salvarChamada = function () {
      document.getElementById("msgChamada").innerHTML =
        '<div class="success-msg">üíæ Chamada salva com sucesso!</div>';
      setTimeout(() => (document.getElementById("msgChamada").innerHTML = ""), 3000);
      atualizarHome();
    };

    // Relat√≥rio
    window.carregarRelatorio = function () {
      const data = document.getElementById("dataRelatorio").value;
      if (!data) return;

      const chamadaData = dados.chamadas[data] || {};
      const salas = ["0-4", "5-7", "8-11", "12-20", "maes"];
      const nomesSalas = {
        "0-4": "0 a 4 anos",
        "5-7": "5 a 7 anos",
        "8-11": "8 a 11 anos",
        "12-20": "12 a 20 anos",
        maes: "Sala das M√£es",
      };

      let html = `<h3>üìÖ Relat√≥rio do dia ${new Date(data + "T00:00:00").toLocaleDateString(
        "pt-BR"
      )}</h3>`;

      let maxFrequencia = 0;
      let salaDestaque = "";
      const dadosSalas = {};

      salas.forEach((sala) => {
        const alunosSala = Object.values(dados.alunos).filter((a) => a.sala === sala);
        const chamadaSala = chamadaData[sala] || {};

        const presentes = Object.values(chamadaSala).filter((s) => s === "presente").length;
        const faltas = Object.values(chamadaSala).filter((s) => s === "falta").length;
        const total = alunosSala.length;

        dadosSalas[sala] = { presentes, faltas, total };

        if (presentes > maxFrequencia) {
          maxFrequencia = presentes;
          salaDestaque = sala;
        }
      });

      salas.forEach((sala) => {
        const dados_sala = dadosSalas[sala];
        const isDestaque = sala === salaDestaque && maxFrequencia > 0;

        html += `
          <div class="relatorio-card ${isDestaque ? "sala-destaque" : ""}">
            <h4>${nomesSalas[sala]}</h4>
            <div class="stats">
              <div class="stat-card">
                <div class="stat-number">${dados_sala.total}</div>
                <div class="stat-label">Total Cadastrados</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" style="color: #00b894;">${dados_sala.presentes}</div>
                <div class="stat-label">Presentes</div>
              </div>
              <div class="stat-card">
                <div class="stat-number" style="color: #e17055;">${dados_sala.faltas}</div>
                <div class="stat-label">Faltas</div>
              </div>
            </div>
            ${
              isDestaque
                ? '<p style="text-align: center; font-weight: bold; color: #d4af37;">ü•á Maior frequ√™ncia do dia!</p>'
                : ""
            }
          </div>
        `;
      });

      document.getElementById("conteudoRelatorio").innerHTML = html;
    };

    // Inicializa√ß√£o
    document.addEventListener("DOMContentLoaded", function () {
      // Data padr√£o hoje para chamada e relat√≥rio
      const hoje = new Date().toISOString().split("T")[0];
      document.getElementById("dataRelatorio").value = hoje;
      document.getElementById("dataChamada").value = hoje;
      atualizarHome();
    });
  </script>
</body>
</html>
